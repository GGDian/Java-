## ZooKeeper作为发现服务的问题

旨在解决**大规模分布式应用场景**下，**服务协调同步**（Coordinate Service）的问题

它可以为同在一个分布式系统中的其他服务提供：**统一命名服务、配置管理、分布式锁服务、集群管理**等功能

ZooKeeper是个**CP**的，即任何时刻对ZooKeeper的访问**请求能得到一致的数据结果**，同时系统对网络分割具备容错性；但是它**不能保证**每次服务请求的**可用性**

它的职责是保证数据（注：配置数据，状态数据）在其管辖下的所有服务之间**保持同步、一致**



作为一个分布式协同服务，ZooKeeper非常好，但是**对于Service发现服务来说就不合适了**；

因为对于Service发现服务来说就算是**返回了包含不实的信息**的结果**也比什么都不返回要好**；

ZooKeeper本身**并没有正确的处理网络分割的问题**

在ZooKeeper中，如果在同一个网络分区（partition）的节点数（nodes）数达不到**ZooKeeper选取Leader节点的“法定人数”时，它们就会从ZooKeeper中断开**，当然同时**也就不能提供Service发现服务了**。



如果给ZooKeeper加上**客户端缓存**（注：给ZooKeeper节点配上本地缓存）或者其他类似技术的话**可以缓解**ZooKeeper**因为网络故障**造成**节点同步信息错误**的问题。当部分或者所有节点跟ZooKeeper断开的情况下，**每个节点还可以从本地缓存中获取到数据**。但是，即便如此，**ZooKeeper下所有节点不可能保证任何时候都能缓存所有的服务注册信息**。如果ZooKeeper下所有节点都断开了，或者集群中出现了**网络分割的故障**（注：由于交换机故障导致交换机底下的子网间不能互访）；那么**ZooKeeper会将它们都从自己管理范围中剔除出去**，外界就不能访问到这些节点了，即便**这些节点本身是“健康”的**，可以正常提供服务的；所以导致到达这些节点的服务请求被丢失了。（注：这也是为什么ZooKeeper不满足CAP中A的原因）

但是，ZooKeeper设计的本意是**保持节点的数据一致**，也就是CP。所以，这样一来，你可能**既得不到**一个数据**一致的**（CP）也得不到一个**高可用的**（AP）的Service发现服务了







![image-20200328144256378](C:\Users\垫\AppData\Roaming\Typora\typora-user-images\image-20200328144256378.png)

![image-20200328145112111](C:\Users\垫\AppData\Roaming\Typora\typora-user-images\image-20200328145112111.png)